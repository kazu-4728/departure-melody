<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>JR ç™ºè»Šãƒ¡ãƒ­ãƒ‡ã‚£</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
 body{font-family:sans-serif;text-align:center;margin:0;background:#f4f7fa}
 header{background:#0f4c81;color:#fff;padding:12px 0;font-size:1.4rem}
 main{padding:20px}
 select,button{font-size:1rem;padding:6px 12px;margin:6px;border-radius:6px;border:1px solid #bbb}
 button{background:#0f4c81;color:#fff}
 iframe{width:90%;height:200px;border:none;margin-top:14px}
 @media(min-width:600px){iframe{height:260px}}
</style>
</head>
<body>
<header>ğŸš† JR ç™ºè»Šãƒ¡ãƒ­ãƒ‡ã‚£</header>
<main>
  <img src="img/train.png" alt="train" width="260"><br>
  <select id="lineSel"><option value="">è·¯ç·šã‚’é¸æŠ</option></select><br>
  <select id="stationSel"><option>é§…ã‚’é¸æŠ</option></select><br>
  <input id="searchBox" list="stationsList" placeholder="é§…åæ¤œç´¢"><datalist id="stationsList"></datalist><br>
  <button onclick="play()">â–¶ å†ç”Ÿ</button>
  <button onclick="stop()">â¹ åœæ­¢</button>
  <iframe id="player" title="melody player"></iframe>
</main>
<script src="station_index.js"></script>
<script>
const lineSel = document.getElementById('lineSel');
const stationSel = document.getElementById('stationSel');
const player = document.getElementById('player');
const searchBox = document.getElementById('searchBox');
const stationsList = document.getElementById('stationsList');

// æ¤œç´¢å€™è£œã‚’ã‚»ãƒƒãƒˆ
if (typeof stationIndex !== 'undefined') {
  stationIndex.forEach(s => {
    const op = document.createElement('option');
    op.value = s.station;
    stationsList.appendChild(op);
  });
}

// è·¯ç·šä¸€è¦§ãƒ­ãƒ¼ãƒ‰
fetch('lines_manifest.json')
  .then(r=>r.json())
  .then(lines=>{
    lines.forEach(l=>{
      const op=document.createElement('option');
      op.value=l.id; op.textContent=l.name;
      lineSel.appendChild(op);
    });
  });

// è·¯ç·šé¸æŠã§é§…ä¸€è¦§ãƒ­ãƒ¼ãƒ‰
lineSel.addEventListener('change', ()=>{
  stationSel.innerHTML='<option>èª­ã¿è¾¼ã¿ä¸­â€¦</option>';
  if(!lineSel.value){player.src='about:blank';return;}
  fetch(`lines/${lineSel.value}.json`)
    .then(r=>r.json())
    .then(sts=>{
      stationSel.innerHTML='';
      sts.forEach(s=>{
        const op=document.createElement('option');
        op.value = s.url || '';
        op.textContent = s.station + (s.url ? '' : 'ï¼ˆéŸ³æºãªã—ï¼‰');
        stationSel.appendChild(op);
      });
    });
});

// é§…åæ¤œç´¢
searchBox.addEventListener('change', ()=>{
  const name = searchBox.value.trim();
  const info = stationIndex.find(s => s.station === name);
  if(!info) return;
  lineSel.value = info.line;
  fetch(`lines/${info.line}.json`)
    .then(r=>r.json())
    .then(sts=>{
      stationSel.innerHTML='';
      sts.forEach(s=>{
        const op=document.createElement('option');
        op.value = s.url || '';
        op.textContent = s.station + (s.url ? '' : 'ï¼ˆéŸ³æºãªã—ï¼‰');
        stationSel.appendChild(op);
      });
      stationSel.value = info.url || '';
    });
});

// å†ç”Ÿåœæ­¢
function play(){
  if(stationSel.value){
    player.src = stationSel.value + '?autoplay=1';
  }else{
    alert('ã“ã®é§…ã¯éŸ³æºæœªç™»éŒ²ã§ã™');
  }
}
function stop(){player.src='about:blank';}
</script>
</body>
</html>
